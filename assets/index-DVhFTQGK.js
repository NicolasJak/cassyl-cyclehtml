(function(){const D=document.createElement("link").relList;if(D&&D.supports&&D.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))g(r);new MutationObserver(r=>{for(const d of r)if(d.type==="childList")for(const v of d.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&g(v)}).observe(document,{childList:!0,subtree:!0});function I(r){const d={};return r.integrity&&(d.integrity=r.integrity),r.referrerPolicy&&(d.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?d.credentials="include":r.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function g(r){if(r.ep)return;r.ep=!0;const d=I(r);fetch(r.href,d)}})();function Se(){sap.ui.require(["sap/m/App","sap/m/Page","sap/m/Wizard","sap/m/WizardStep","sap/m/Button","sap/m/VBox","sap/m/HBox","sap/m/Text","sap/m/Panel","sap/m/List","sap/m/InputListItem","sap/m/DatePicker","sap/ui/layout/VerticalLayout","sap/ui/model/json/JSONModel"],function(B,D,I,g,r,d,v,w,he,k,H,J,K,W){const e=new W({knowsCycleDuration:null,cycles:[{date:""},{date:""},{date:""},{date:""}],averageCycleLength:null,startDate:null,ovulationDate:null,fertileStart:null,fertileEnd:null,fertilitySummary:null,NidationStart:null,NidationEnd:null,PriseSang:null,Nextcycle:null});function _(){location.reload()}const E=new r({text:"Oui",width:"150px",press:function(){e.setProperty("/knowsCycleDuration","yes"),t.indexOfStep(f)!==-1&&t.removeStep(f),t.indexOfStep(y)!==-1&&t.removeStep(y),t.indexOfStep(P)===-1&&t.addStep(P),t.indexOfStep(y)===-1&&t.addStep(y),$.setValidated(!0),E.setEnabled(!1),O.setEnabled(!1),t.goToStep(P,!0),t.nextStep()}}).addStyleClass("sapUiMediumMarginStart sapUiMediumMarginEnd"),O=new r({text:"Non",width:"150px",press:function(){e.setProperty("/knowsCycleDuration","no"),t.indexOfStep(P)!==-1&&t.removeStep(P),t.indexOfStep(y)!==-1&&t.removeStep(y),t.indexOfStep(f)===-1&&t.addStep(f),t.indexOfStep(y)===-1&&t.addStep(y),$.setValidated(!0),E.setEnabled(!1),O.setEnabled(!1),t.goToStep(f,!0),t.nextStep()}}).addStyleClass("sapUiMediumMarginStart sapUiMediumMarginEnd"),$=new g({title:"Dur√©e du cycle",id:"Step1",validated:!1,content:[new w({text:"Connaissez-vous la dur√©e moyenne de votre cycle ?"}),new v({alignItems:"Center",justifyContent:"Center",width:"100%",items:[E,O]})]}),A=new sap.m.Input({id:"averageCycleInput",type:"Text",value:"{/averageCycleLength}",placeholder:"Entrez la dur√©e moyenne (en jours)",width:"250px",liveChange:function(s){const i=s.getParameter("value");e.setProperty("/averageCycleLength",i),T()},change:function(s){const i=s.getParameter("value");e.setProperty("/averageCycleLength",i),T()}}).addStyleClass("sapUiSmallMarginTop"),j=new sap.m.DatePicker({id:"startDateInput",placeholder:"S√©lectionnez la date de vos derni√®res r√®gles",value:"{/startDate}",displayFormat:"dd/MM/yyyy",valueFormat:"yyyy-MM-dd",width:"350px",change:T}).addStyleClass("sapUiSmallMarginTop"),P=new g({title:"Dur√©e connue",id:"Step2a",validated:!1,content:[new sap.m.VBox({alignItems:"Start",items:[new w({text:"Vous avez indiqu√© que vous connaissez la dur√©e moyenne de votre cycle."}),A,j]})]}),z=new k({width:"100%",items:{path:"/cycles",factory:function(s,i){const l=i.getPath().split("/").pop();return new H({content:new v({alignItems:"Center",justifyContent:"SpaceBetween",width:"40%",items:[new sap.m.Label({text:`Cycle ${parseInt(l,10)+1} - 1er jour des r√®gles`,required:parseInt(l,10)<2,wrapping:!0}).addStyleClass("sapUiLargeMarginEnd"),new J({value:"{date}",displayFormat:"dd/MM/yyyy",valueFormat:"yyyy-MM-dd",change:function(){F()}})]})})}}}).setModel(e),f=new g({title:"Dates des cycles",id:"Step2b",validated:!1,content:[new w({text:"Renseignez les dates de vos derni√®res regles:"}),z]}),t=new I({width:"100%",finishButtonText:"Terminer",complete:_,steps:[$]});t.addStyleClass("sapUiResponsivePadding--header sapUiResponsivePadding--content");function T(){const s=Number(e.getProperty("/averageCycleLength")),i=e.getProperty("/startDate"),l=!isNaN(s)&&s>0&&i&&i.length>0;l!=null&&(P.setValidated(l),j.setEditable(!l),A.setEditable(!l))}function F(){var l,C,b,u;const s=e.getProperty("/cycles"),i=((C=(l=s[0])==null?void 0:l.date)==null?void 0:C.length)>0&&((u=(b=s[1])==null?void 0:b.date)==null?void 0:u.length)>0;f.setValidated(!!i)}f.attachActivate(F),z.getBinding("items").attachChange(()=>F());const G=new w({text:"Votre cycle a √©t√© d√©termin√©."}),Q=new w({text:{path:"/averageCycleLength",formatter:function(s){return s?`La dur√©e moyenne de votre cycle est de : ${s} jours`:"La dur√©e moyenne de votre cycle n'a pas pu √™tre calcul√©e."}}}),X=new w({text:{parts:["/startDate"],formatter:function(s){if(!s)return"La date de d√©but du cycle n'a pas √©t√© fournie.";const i=new Date(s),l={day:"2-digit",month:"2-digit",year:"numeric"};return"Date des derni√®res r√®gles : "+i.toLocaleDateString("fr-FR",l)}}}),Z=new sap.m.MessageStrip({text:"{/fertilitySummary}",enableFormattedText:!0,showIcon:!1,showCloseButton:!1,type:"Success"}).addStyleClass("sapUiMediumMarginBottom"),ee=new K({width:"100%",content:[G,Q,X,Z]}).addStyleClass("sapUiContentPadding"),y=new g({title:"Votre cycle",id:"Step3",validated:!0,content:[ee]});t.attachStepActivate(function(s){const i=t.getCurrentStep();if(i==="Step2b"){const p=e.getProperty("/cycles").map(a=>a.date).filter(a=>!!a).map(a=>new Date(a));let m=[];for(let a=1;a<p.length;a++){const c=(p[a]-p[a-1])/864e5-1;!isNaN(c)&&c>0&&m.push(c)}if(m.length>0){const a=m.reduce((c,x)=>c+x,0)/m.length;e.setProperty("/averageCycleLength",Math.round(a)),console.log("Cycle length average calculated from dates:",Math.round(a))}else e.setProperty("/averageCycleLength",null),console.warn("Not enough data to compute average cycle length.");if(p.length>0){const a=new Date(Math.max.apply(null,p)),c=a.getFullYear(),x=String(a.getMonth()+1).padStart(2,"0"),U=String(a.getDate()).padStart(2,"0"),N=`${c}-${x}-${U}`;e.setProperty("/startDate",N),console.log("Start date set to latest:",N)}else e.setProperty("/startDate",null),console.warn("No valid dates found to set start date.")}else i==="Step2a"&&console.log("Step3 activated from Step2a, no recalculation needed.");function l(n){const p=t.getCurrentStep();if(!p.endsWith("Step2a")){if(p.endsWith("Step2b")){const L=n.getProperty("/cycles").map(o=>o.date).filter(o=>!!o).map(o=>new Date(o));let M=[];for(let o=1;o<L.length;o++){const S=(L[o]-L[o-1])/864e5;!isNaN(S)&&S>0&&M.push(S)}if(M.length>0){const o=M.reduce((S,V)=>S+V,0)/M.length;n.setProperty("/averageCycleLength",Math.round(o))}else n.setProperty("/averageCycleLength",null);if(L.length>0){const o=new Date(Math.max.apply(null,L)),S=o.getFullYear(),V=String(o.getMonth()+1).padStart(2,"0"),fe=String(o.getDate()).padStart(2,"0"),me=`${S}-${V}-${fe}`;n.setProperty("/startDate",me)}else n.setProperty("/startDate",null)}}const m=n.getProperty("/averageCycleLength"),a=n.getProperty("/startDate"),c=moment(a).add(m-14,"days"),x=moment(c).subtract(4,"days"),U=moment(c).add(1,"days"),N=moment(c).add(6,"days"),ue=moment(c).add(10,"days"),ye=moment(c).add(12,"days"),ge=moment(a).add(m,"days").format("YYYY-MM-DD");n.setProperty("/ovulationDate",c),n.setProperty("/fertileStart",x),n.setProperty("/fertileEnd",U),n.setProperty("/NidationStart",N),n.setProperty("/NidationEnd",ue),n.setProperty("/PriseSang",ye),n.setProperty("/Nextcycle",ge)}l(e);const C=e.getProperty("/averageCycleLength"),b=C?`La dur√©e moyenne de votre cycle est de : ${C} jours`:"La dur√©e moyenne de votre cycle n'a pas pu √™tre calcul√©e.";e.setProperty("/averageCycleText",b);const u=n=>n?new Date(n).toLocaleDateString("fr-FR",{day:"2-digit",month:"long",year:"numeric"}):"<i>non disponible</i>",ae=n=>{if(!n)return"<i>non disponible</i>";const p=new Date(n);return Y.month()===q.month()?p.toLocaleDateString("fr-FR",{day:"2-digit"}):p.toLocaleDateString("fr-FR",{day:"2-digit",month:"long"})},R=e.getProperty("/startDate"),re=new Date(R),se=R?`Date des derni√®res r√®gles : ${u(re)}`:"La date de d√©but du cycle n'a pas √©t√© fournie.";e.setProperty("/startDateText",se);const oe=e.getProperty("/ovulationDate"),ie=e.getProperty("/fertileStart"),le=e.getProperty("/fertileEnd"),Y=e.getProperty("/NidationStart"),q=e.getProperty("/NidationEnd"),ce=e.getProperty("/PriseSang"),de=e.getProperty("/Nextcycle"),pe=`ü©∑ <strong>Date d'ovulation :</strong> ${u(oe)}<br>üå± <strong>D√©but de la p√©riode fertile :</strong> ${u(ie)}<br>üå∏ <strong>Fin de la p√©riode fertile :</strong> ${u(le)}<br>ü™∫ <strong>Nidation :</strong> entre le ${ae(Y)} et le ${u(q)}<br>ü©∏ <strong>Prise de sang :</strong> √† partir du ${u(ce)}<br>üîÅ <strong>Prochain cycle :</strong> ${u(de)}`;e.setProperty("/fertilitySummary",pe)});const te=new sap.m.OverflowToolbar({content:[new sap.m.ToolbarSpacer,new sap.m.Button({text:"Recommencer",press:function(){location.reload()}})]}),ne=new D({title:"Assistant Cycle",content:[t],footer:te});new B({pages:[ne]}).placeAt("content"),t.setModel(e)})}window.onUI5Init=Se;const h=document.createElement("script");h.id="sap-ui-bootstrap";h.src="https://sdk.openui5.org/resources/sap-ui-core.js";h.setAttribute("data-sap-ui-libs","sap.m");h.setAttribute("data-sap-ui-theme","sap_horizon");h.setAttribute("data-sap-ui-async","true");h.setAttribute("data-sap-ui-onInit","onUI5Init");document.head.appendChild(h);
